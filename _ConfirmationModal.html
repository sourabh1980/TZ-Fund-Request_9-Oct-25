<style>
  /* Modal overlay with dimmed, blurred background */
  .confirmation-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .confirmation-overlay.show {
    opacity: 1;
    visibility: visible;
  }

  /* Modal card with spring animation */
  .confirmation-modal {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 40px 36px;
    max-width: 560px;
    width: min(96%, 560px);
    text-align: center;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 8px 32px rgba(0, 0, 0, 0.15);
    transform: scale(0.7) translateY(50px);
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
  }

  .confirmation-overlay.show .confirmation-modal {
    transform: scale(1) translateY(0);
  }

  /* Pulsing badge */
  .confirmation-badge {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    margin: 0 auto 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    animation: pulse 2s ease-in-out infinite;
  }

  .confirmation-badge::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    opacity: 0.3;
    animation: pulse-ring 2s ease-in-out infinite;
  }

  .confirmation-badge svg {
    width: 40px;
    height: 40px;
    fill: white;
    z-index: 1;
    position: relative;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  @keyframes pulse-ring {
    0% { transform: scale(1); opacity: 0.3; }
    50% { transform: scale(1.1); opacity: 0.1; }
    100% { transform: scale(1.2); opacity: 0; }
  }

  /* Modal content */
  .confirmation-title {
    font-size: 24px;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 12px;
    line-height: 1.2;
  }

  .confirmation-message {
    font-size: 16px;
    color: #718096;
    margin-bottom: 32px;
    line-height: 1.5;
  }

  /* Button container */
  .confirmation-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
  }

  @media (min-width: 520px) {
    .confirmation-buttons {
      flex-direction: row;
      justify-content: center;
      flex-wrap: wrap;
      gap: 16px;
    }
  }

  .confirmation-btn {
    position: relative;
    border-radius: 16px;
    padding: 14px 28px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    overflow: hidden;
    flex: 1 1 220px;
    min-width: 220px;
  }

  @media (max-width: 519.98px) {
    .confirmation-btn {
      width: 100%;
      min-width: 0;
    }
  }

  .confirmation-btn:focus-visible {
    outline: 3px solid rgba(102, 126, 234, 0.35);
    outline-offset: 2px;
  }

  .confirmation-btn.primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    box-shadow: 0 12px 32px rgba(102, 126, 234, 0.35);
  }

  .confirmation-btn.primary:hover {
    transform: perspective(1000px) rotateX(-4deg) rotateY(4deg);
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
  }

  .confirmation-btn.primary:active {
    transform: scale(0.98);
  }

  .confirmation-btn.success {
    background: linear-gradient(135deg, #34d399 0%, #059669 100%);
    color: #fff;
    box-shadow: 0 12px 32px rgba(52, 211, 153, 0.35);
  }

  .confirmation-btn.success:hover {
    transform: translateY(-1px);
    background: linear-gradient(135deg, #22c55e 0%, #047857 100%);
  }

  .confirmation-btn.success:active {
    transform: scale(0.98);
  }

  .confirmation-btn.destructive {
    background: linear-gradient(135deg, #f56565 0%, #e11d48 100%);
    color: #fff;
    box-shadow: 0 12px 32px rgba(229, 62, 62, 0.3);
  }

  .confirmation-btn.destructive:hover {
    transform: translateY(-1px);
    background: linear-gradient(135deg, #ef4444 0%, #be123c 100%);
  }

  .confirmation-btn.destructive:active {
    transform: scale(0.98);
  }

  .confirmation-btn.accent {
    background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
    color: #fff;
    box-shadow: 0 12px 32px rgba(234, 88, 12, 0.28);
  }

  .confirmation-btn.accent:hover {
    transform: translateY(-1px);
    background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
  }

  .confirmation-btn.accent:active {
    transform: scale(0.98);
  }

  .confirmation-btn.secondary {
    background: transparent;
    color: #4a5568;
    border: 2px solid #e2e8f0;
  }

  .confirmation-btn.secondary:hover {
    background: #f7fafc;
    border-color: #cbd5e0;
  }

  .confirmation-btn.secondary:active {
    transform: scale(0.98);
  }

  .confirmation-btn.with-feedback::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.25);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
  }

  .confirmation-btn.with-feedback.ripple::before {
    width: 260px;
    height: 260px;
  }

  .confirmation-btn.with-feedback.success {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    box-shadow: 0 0 0 0 rgba(72, 187, 120, 0.7);
    animation: success-halo 0.6s ease-out;
  }

  @keyframes success-halo {
    0% {
      box-shadow: 0 0 0 0 rgba(72, 187, 120, 0.7);
    }
    70% {
      box-shadow: 0 0 0 20px rgba(72, 187, 120, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(72, 187, 120, 0);
    }
  }

  /* View cost breakdown link */
  .confirmation-link {
    color: #667eea;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    margin-top: 16px;
    display: inline-block;
    transition: color 0.3s ease;
  }

  .confirmation-link:hover {
    color: #5a67d8;
    text-decoration: underline;
  }

  /* Close indicator */
  .confirmation-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 8px;
    height: 8px;
    background: #f56565;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .confirmation-close:hover {
    transform: scale(1.2);
  }
</style>

<div class="confirmation-overlay" id="confirmationModal">
  <div class="confirmation-modal">
    <div class="confirmation-close" onclick="closeConfirmationModal()"></div>
    
    <div class="confirmation-badge">
      <svg viewBox="0 0 24 24">
        <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 7.5V9M15 11.5V9.5L21 9V11L15 11.5ZM11 12C8.8 12 7 10.2 7 8S8.8 4 11 4 15 5.8 15 8 13.2 12 11 12ZM11 14C14.3 14 17 16.7 17 20V22H5V20C5 16.7 7.7 14 11 14Z"/>
      </svg>
    </div>
    
    <h2 class="confirmation-title" id="confirmationTitle">Reactivate beneficiary?</h2>
    <p class="confirmation-message" id="confirmationMessage">Re-enabling means you'll fund their expenses. Continue?</p>
    
    <div class="confirmation-buttons" id="confirmationButtons"></div>
    
    <a href="#" class="confirmation-link" onclick="viewCostBreakdown()">View cost breakdown</a>
  </div>
</div>

<script>
(function() {
  let currentResolve = null;
  let currentReject = null;
  let buttonConfigs = [];
  let buttonElements = [];

  function normalizeButtons(options = {}) {
    const supplied = Array.isArray(options.buttons) ? options.buttons.filter(Boolean) : [];
    if (supplied.length) {
      return supplied.map((btn, index) => {
        const role = btn.role || (index === 0 ? 'confirm' : 'option');
        const variant = btn.variant || (role === 'destructive' ? 'destructive' : role === 'cancel' ? 'secondary' : 'primary');
        const value = Object.prototype.hasOwnProperty.call(btn, 'value') ? btn.value : (role === 'cancel' ? false : btn.text || true);
        return {
          text: btn.text || btn.label || `Option ${index + 1}`,
          value,
          role,
          variant,
          feedback: btn.feedback === undefined ? (variant === 'primary') : Boolean(btn.feedback),
          successText: btn.successText,
          focus: btn.focus === true,
          id: btn.id ? String(btn.id) : ''
        };
      });
    }

    return [
      {
        text: options.yesText || 'Yes',
        value: true,
        role: 'confirm',
        variant: 'primary',
        feedback: true,
        successText: options.successText || '✓ Confirmed'
      },
      {
        text: options.noText || 'Cancel',
        value: false,
        role: 'cancel',
        variant: 'secondary',
        feedback: false
      }
    ];
  }

  function resetButtons() {
    buttonElements.forEach(btn => {
      btn.classList.remove('ripple', 'success');
      if (btn.dataset && btn.dataset.originalText) {
        btn.textContent = btn.dataset.originalText;
      }
    });
    buttonElements = [];
    buttonConfigs = [];
  }

  function renderButtons(configs) {
    const container = document.getElementById('confirmationButtons');
    container.innerHTML = '';
    buttonElements = configs.map((config, index) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = `confirmation-btn ${config.variant}`;
      if (config.feedback) {
        btn.classList.add('with-feedback');
      }
      btn.textContent = config.text;
      btn.dataset.index = String(index);
      btn.dataset.originalText = config.text;
      if (config.id) {
        btn.dataset.buttonId = config.id;
      }
      btn.addEventListener('click', () => selectButton(index));
      container.appendChild(btn);
      return btn;
    });
  }

  function selectButton(index) {
    const config = buttonConfigs[index];
    const btn = buttonElements[index];
    if (!config || !btn) return;

    const finalize = () => {
      const resolver = currentResolve;
      currentResolve = null;
      if (typeof resolver === 'function') {
        resolver(config.value);
      }
      closeConfirmationModal({ resolve: true });
    };

    if (config.feedback && btn.classList.contains('with-feedback')) {
      btn.classList.add('ripple');
      setTimeout(() => {
        btn.classList.add('success');
        btn.textContent = config.successText || '✓ Confirmed';
        setTimeout(finalize, 650);
      }, 120);
    } else {
      finalize();
    }
  }

  function focusInitialButton() {
    const explicitIndex = buttonConfigs.findIndex(cfg => cfg.focus);
    const targetIndex = explicitIndex >= 0 ? explicitIndex : 0;
    const btn = buttonElements[targetIndex];
    if (btn) {
      btn.focus();
    }
  }

  // Show confirmation modal
  window.showConfirmationModal = function(options = {}) {
    return new Promise((resolve, reject) => {
      currentResolve = resolve;
      currentReject = reject;

      const modal = document.getElementById('confirmationModal');
      const title = document.getElementById('confirmationTitle');
      const message = document.getElementById('confirmationMessage');

      title.textContent = options.title || 'Reactivate beneficiary?';
      message.textContent = options.message || "Re-enabling means you'll fund their expenses. Continue?";

      buttonConfigs = normalizeButtons(options);
      renderButtons(buttonConfigs);

      modal.classList.add('show');
      setTimeout(focusInitialButton, 120);
    });
  };

  window.updateConfirmationButton = function(buttonId, props = {}) {
    if (!buttonId) return;
    const idx = buttonConfigs.findIndex(cfg => cfg && cfg.id === buttonId);
    if (idx < 0) return;
    const config = buttonConfigs[idx];
    const btn = buttonElements[idx];
    if (!config || !btn) return;

    if (Object.prototype.hasOwnProperty.call(props, 'text')) {
      const nextText = props.text == null ? '' : String(props.text);
      config.text = nextText;
      btn.textContent = nextText;
      btn.dataset.originalText = nextText;
    }
  };

  // Close confirmation modal
  window.closeConfirmationModal = function(options = {}) {
    const modal = document.getElementById('confirmationModal');
    modal.classList.remove('show');

    const resolved = options && options.resolve === true;
    if (!resolved && typeof currentReject === 'function') {
      currentReject(false);
    }

    currentResolve = null;
    currentReject = null;
    resetButtons();
  };

  // Handle Yes button click
  window.handleConfirmationYes = function() {
    selectButton(0);
  };

  // Handle No button click
  window.handleConfirmationNo = function() {
    const cancelIndex = buttonConfigs.findIndex(cfg => cfg.role === 'cancel');
    const target = cancelIndex >= 0 ? cancelIndex : buttonConfigs.length - 1;
    if (target >= 0) {
      selectButton(target);
    } else {
      closeConfirmationModal();
    }
  };

  // View cost breakdown (placeholder)
  window.viewCostBreakdown = function() {
    console.log('View cost breakdown clicked');
    // Implement cost breakdown functionality here
  };

  // Keyboard support
  document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('confirmationModal');
    if (!modal.classList.contains('show')) return;
    
    if (e.key === 'Escape') {
      closeConfirmationModal();
    } else if (e.key === 'Enter') {
      handleConfirmationYes();
    }
  });

  // Click outside to close
  document.getElementById('confirmationModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeConfirmationModal();
    }
  });
})();
</script>